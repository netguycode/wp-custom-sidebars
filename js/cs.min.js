function CsSidebar(k,a){this.id=k.split("%").join("\\%");this.type=a;this.sb=jQuery("#"+this.id);this.widgets="";this.name=trim(this.sb.find(".sidebar-name h3").text());this.description=trim(this.sb.find(".sidebar-description").text());var b="custom"==a?csSidebars.extras.find(".cs-custom-sidebar").clone():csSidebars.extras.find(".cs-theme-sidebar").clone();this.sb.parent().append(b);b.find("label").each(function(){var b=jQuery(this);csSidebars.addIdToLabel(b,k)})}CsSidebar.prototype.getID=function(){return this.id.split("\\").join("")};
var csSidebars,msgTimer;
(function(k){csSidebars={sidebars:[],sidebar_prefix:"cs-",edit_form:null,delete_form:null,export_form:null,location_form:null,right:null,extras:null,action_handlers:{},init:function(){"undefined"!=typeof csSidebarsData&&csSidebars.initControls().initScrollbar().initTopTools().initSidebars().initToolbars().initColumns()},initControls:function(){csSidebars.right=jQuery("#widgets-right");csSidebars.extras=jQuery("#cs-widgets-extra");null==csSidebars.edit_form&&(csSidebars.edit_form=csSidebars.extras.find(".cs-editor").clone(),
csSidebars.extras.find(".cs-editor").remove());null==csSidebars.delete_form&&(csSidebars.delete_form=csSidebars.extras.find(".cs-delete").clone(),csSidebars.extras.find(".cs-delete").remove());null==csSidebars.export_form&&(csSidebars.export_form=csSidebars.extras.find(".cs-export").clone(),csSidebars.extras.find(".cs-export").remove());null==csSidebars.location_form&&(csSidebars.location_form=csSidebars.extras.find(".cs-location").clone(),csSidebars.extras.find(".cs-location").remove());jQuery("#cs-title-options").detach().prependTo(csSidebars.right);
return csSidebars},initScrollbar:function(){var a=jQuery(".widget-liquid-right");wnd=jQuery(window);scrollbar=viewport=null;csSidebars.right.addClass("overview").wrap('<div class="viewport" />');viewport=jQuery(".viewport").height(wnd.height()-60);a.height(wnd.height()).prepend('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>').tinyscrollbar();scrollbar=a.data("plugin_tinyscrollbar");var b=function(){scrollbar.update("relative")};wnd.resize(function(){a.height(wnd.height());
viewport.height(wnd.height()-60);scrollbar.update("relative")});a.click(function(){setTimeout(b,400)});a.hover(function(){k(".scrollbar").fadeIn()},function(){k(".scrollbar").fadeOut()});return csSidebars},initColumns:function(){var a=csSidebars.right.find(".sidebars-column-1"),b=csSidebars.right.find(".sidebars-column-2"),c=jQuery('<div class="cs-title"><h3></h3></div>'),h=csSidebars.right.find(".widgets-holder-wrap");b.length||(b=jQuery('<div class="sidebars-column-2"></div>'),b.appendTo(csSidebars.right));
c.clone().prependTo(a).find("h3").text(csSidebarsData.custom_sidebars);c.clone().prependTo(b).find("h3").text(csSidebarsData.theme_sidebars);a=jQuery('<div class="inner"></div>').appendTo(a);b=jQuery('<div class="inner"></div>').appendTo(b);h.each(function(){var c=jQuery(this),d=c.find(".widgets-sortables");csSidebars.isCustomSidebar(d)?c.appendTo(a):c.appendTo(b)})},initSidebars:function(){csSidebars.right.find(".widgets-sortables").each(function(){var a,b;a=jQuery(this);var c=a.attr("id");if(!0!==
a.data("cs-init"))if(a.data("cs-init",!0),csSidebars.isCustomSidebar(this))csSidebars.add(c,"custom");else{a=csSidebars.add(c,"theme");b=!1;for(key in csSidebarsData.replaceable)if(csSidebarsData.replaceable[key]==c){b=!0;break}csSidebars.setReplaceable(a,b,!1)}});return csSidebars},initTopTools:function(){var a=jQuery(".btn-create-sidebar"),b=jQuery(".btn-export"),c={};a.click(function(){c.id="";c.title=csSidebarsData.title_new;c.button=csSidebarsData.btn_new;c.description="";c.name="";csSidebars.showEditor(c)});
b.click(csSidebars.showExport);return csSidebars},initToolbars:function(){csSidebars.registerAction("edit",csSidebars.showEditor);csSidebars.registerAction("location",csSidebars.showLocations);csSidebars.registerAction("delete",csSidebars.showRemove);csSidebars.registerAction("replaceable",csSidebars.setReplaceable);csSidebars.right.on("click",".cs-tool",function(a){var b=jQuery(a.target).closest(".cs-tool");a=b.data("action");b=csSidebars.getIdFromEditbar(b);b=csSidebars.find(b);return!csSidebars.handleAction(a,
b)});return csSidebars},handleAction:function(a,b){return"function"==typeof csSidebars.action_handlers[a]?!!csSidebars.action_handlers[a](b):!1},registerAction:function(a,b){csSidebars.action_handlers[a]=b},showAjaxError:function(a){var b={};b.message=csSidebarsData.ajax_error;b.details=a;b.parent="#widgets-right";b.insert_after="#cs-title-options";b.id="editor";b.type="err";wpmUi.message(b)},showEditor:function(a){var b=null,c=null;a instanceof CsSidebar&&(a={id:a.getID(),title:csSidebarsData.title_edit.replace("[Sidebar]",
a.name),button:csSidebarsData.btn_edit});var h=function(){b.$().removeClass("csb-has-more");b.size(null,215)},g=function(a,c,d){b.loading(!1);if(!a)return!1;if(!c)return b.close(),csSidebars.showAjaxError(a),!1;void 0!==a.sidebar&&(a=a.sidebar);void 0!==a.id&&b.$().find("#csb-id").val(a.id);void 0!==a.name&&b.$().find("#csb-name").val(a.name);void 0!==a.description&&b.$().find("#csb-description").val(a.description);void 0!==a.before_title&&b.$().find("#csb-before-title").val(a.before_title);void 0!==
a.after_title&&b.$().find("#csb-after-title").val(a.after_title);void 0!==a.before_widget&&b.$().find("#csb-before-widget").val(a.before_widget);void 0!==a.after_widget&&b.$().find("#csb-after-widget").val(a.after_widget);void 0!==a.button&&b.$().find(".btn-save").text(a.button)},d=function(a,c,d){d={};b.loading(!1).close();d.message=a.message;d.parent="#widgets-right";d.insert_after="#cs-title-options";d.id="editor";c?"update"==a.action?(c=csSidebars.find(a.data.id),csSidebars.updateSidebar(c,a.data)):
"insert"==a.action&&csSidebars.insertSidebar(a.data):d.type="err";wpmUi.message(d)},b=wpmUi.popup().modal(!0).title(a.title).onshow(h).content(csSidebars.edit_form);h();g(a,!0,null);c=wpmUi.ajax(null,"cs-ajax");a.id&&(b.loading(!0),c.reset().data({"do":"get",sb:a.id}).ondone(g).load_json());b.show();b.$().find("#csb-name").focus();b.$().on("click","#csb-more",function(){jQuery(this).prop("checked")?(b.$().addClass("csb-has-more"),b.size(null,545)):h()});b.$().on("click",".btn-save",function(){var a=
b.$().find("form");b.loading(!0);c.reset().data(a).ondone(d).load_json();return!1});b.$().on("click",".btn-cancel",b.close);return!0},updateSidebar:function(a,b){a.sb.find(".sidebar-name h3").text(b.name);a.sb.find(".sidebar-description").html('<p class="description"></p>').find(".description").text(b.description);return csSidebars},insertSidebar:function(a){var b=jQuery('<div class="widgets-holder-wrap"></div>'),c=jQuery('<div class="widgets-sortables ui-sortable"></div>'),h=jQuery('<div class="sidebar-name"><div class="sidebar-name-arrow"><br></div><h3></h3></div>'),
g=jQuery('<div class="sidebar-description"></div>'),d=csSidebars.right.find(".sidebars-column-1 > .inner:first");c.attr("id",a.id);h.find("h3").text(a.name);g.html('<p class="description"></p>').find(".description").text(a.description);h.appendTo(c);g.appendTo(c);c.appendTo(b);b.prependTo(d);jQuery("#widgets-right .sidebar-name").unbind("click");jQuery("#widgets-left .sidebar-name").unbind("click");jQuery(document.body).unbind("click.widgets-toggle");jQuery(".widgets-chooser").off("click.widgets-chooser").off("keyup.widgets-chooser");
wpWidgets.init();csSidebars.initSidebars();return csSidebars},showExport:function(){var a=null,b=null,c=function(b,c,d){d={};a.loading(!1);c?a.size(900,600).content(b.html):(d.message=b.message,d.parent=a.$().find(".wpmui-wnd-content"),d.insert_after=!1,d.id="export",d["class"]="wpmui-wnd-err",d.type="err",wpmUi.message(d))},a=wpmUi.popup().modal(!0).size(740,480).title(csSidebarsData.title_export).content(csSidebars.export_form).show(),b=wpmUi.ajax(null,"cs-ajax");a.$().on("submit",".frm-export",
function(c){var g=jQuery(this).closest("form");b.reset().data(g).load_http();a.close();c.preventDefault();return!1});a.$().on("submit",".frm-preview-import",function(b){var g=wpmUi.ajax(),d=jQuery(this).closest("form");a.loading(!0);g.data(d).ondone(c).load_json("cs-ajax");b.preventDefault();return!1});a.$().on("change","#import-widgets",function(){var b=jQuery(this).prop("checked"),c=a.$().find(".column-widgets, .import-widgets");b?c.show():c.hide()});a.$().on("click",".btn-cancel",function(){a.size(740,
480).content(csSidebars.export_form)});a.$().on("click",".btn-import",function(){var c=a.$().find(".frm-import");a.loading(!0);b.reset().data(c).load_http("_self")});return!0},showRemove:function(a){var b=null,c=null,h=a.getID(),g=a.name,d=function(a,c,d){d={};b.loading(!1).close();d.message=a.message;d.parent="#widgets-right";d.insert_after="#cs-title-options";d.id="editor";c?(csSidebars.right.find("#"+h).closest(".widgets-holder-wrap").remove(),csSidebars.remove(h)):d.type="err";wpmUi.message(d)},
b=wpmUi.popup().modal(!0).size(null,160).title(csSidebarsData.title_delete).content(csSidebars.delete_form).onshow(function(a){a.find(".name").text(g)}).show(),c=wpmUi.ajax(null,"cs-ajax");b.$().on("click",".btn-cancel",function(){b.loading(!1).close()});b.$().on("click",".btn-delete",function(){b.loading(!0);c.reset().data({"do":"delete",sb:h}).ondone(d).load_json()});return!0},showLocations:function(a){var b=null,c=null,h=null;a=a.getID();var g=function(a,c,e){e={};b.loading(!1).close();e.message=
a.message;e.parent="#widgets-right";e.insert_after="#cs-title-options";e.id="editor";c||(e.type="err");wpmUi.message(e)},b=wpmUi.popup().modal(!0).size(null,560).title(csSidebarsData.title_location).content(csSidebars.location_form).show();b.loading(!0);h=b.$().find(".frm-location");h.find(".sb-id").val(a);c=wpmUi.ajax(null,"cs-ajax");c.reset().data({"do":"get-location",sb:a}).ondone(function(a,c,e){b.loading(!1);if(c){b.$().find(".sb-name").text(a.sidebar.name);var h=a.sidebar.id;c=b.$().find(".cs-replaceable");
c.hide();for(f in a.replaceable)c.filter("."+a.replaceable[f]).show();var g=function(a,b){var c=jQuery("<option></option>");c.attr("value",f).text(a.name);b.append(c)};c=function(a,b,c,d){b=d.closest(".cs-replaceable").filter("."+b);c=b.find('option[value="'+c+'"]');d=b.find("optgroup.used");var e=b.find(".detail-toggle");a==h?(c.prop("selected",!0),!0!=e.prop("checked")&&(e.prop("checked",!0),b.addClass("open"),wpmUi.upgrade_multiselect(b))):(d.length||(d=jQuery('<optgroup class="used">').attr("label",
b.data("lbl-used")).appendTo(b.find(".details select"))),c.detach().appendTo(d))};var k=b.$().find(".cs-datalist.cs-cat"),l=b.$().find(".cs-datalist.cs-arc-cat");e=a.categories;l.empty();k.empty();for(var f in e)g(e[f],l),g(e[f],k);for(f in e){if(e[f].single)for(var m in e[f].single)c(e[f].single[m],m,f,k);if(e[f].archive)for(m in e[f].archive)c(e[f].archive[m],m,f,l)}l=b.$().find(".cs-datalist.cs-pt");e=a.posttypes;l.empty();for(f in e)g=jQuery("<option></option>"),k=e[f].name,g.attr("value",f).text(k),
l.append(g);for(f in e)if(e[f].single)for(m in e[f].single)c(e[f].single[m],m,f,l);l=b.$().find(".cs-datalist.cs-arc");e=a.archives;l.empty();for(f in e)g=jQuery("<option></option>"),k=e[f].name,g.attr("value",f).text(k),l.append(g);for(f in e)if(e[f].archive)for(m in e[f].archive)c(e[f].archive[m],m,f,l)}else b.close(),csSidebars.showAjaxError(a)}).load_json();b.$().on("click",".detail-toggle",function(a){a=jQuery(this);var b=a.closest(".cs-replaceable"),c=b.find("select");a.prop("checked")?(b.addClass("open"),
wpmUi.upgrade_multiselect(b),c.trigger("change.select2")):(b.removeClass("open"),c.val([]))});b.$().on("click",".btn-save",function(){b.loading(!0);c.reset().data(h).ondone(g).load_json()});b.$().on("click",".btn-cancel",b.close);return!0},setReplaceable:function(a,b,c){var h=jQuery(a.sb).closest(".widgets-holder-wrap"),g=h.find(".cs-toolbar .chk-replaceable"),d=h.find(".replace-marker");h.find(".cs-toolbar .btn-replaceable");void 0==b&&(b=g.prop("checked"));void 0==c&&(c=!0);if(g.data("active")==
b)return!1;g.data("active",b);g.prop("checked",b);b?(d.length||jQuery("<div></div>").appendTo(h).attr("data-label",csSidebarsData.lbl_replaceable).addClass("replace-marker"),h.addClass("replaceable")):(d.remove(),h.removeClass("replaceable"));c&&(c=wpmUi.ajax(null,"cs-ajax"),c.reset().data({"do":"replaceable",state:b,sb:a.getID()}).load_json());return!1},find:function(a){return csSidebars.sidebars[a]},add:function(a,b){csSidebars.sidebars[a]=new CsSidebar(a,b);return csSidebars.sidebars[a]},remove:function(a){delete csSidebars.sidebars[a]},
isCustomSidebar:function(a){return jQuery(a).attr("id").substr(0,csSidebars.sidebar_prefix.length)==csSidebars.sidebar_prefix},addIdToLabel:function(a,b){if(!0!=a.data("label-done")){var c=a.attr("for");a.attr("for",c+b);a.find(".has-label").attr("id",c+b);a.data("label-done",!0)}},getIdFromEditbar:function(a){return a.closest(".widgets-holder-wrap").find(".widgets-sortables:first").attr("id")}};jQuery(function(a){a("#csfooter").hide();0<a("#widgets-right").length&&csSidebars.init();a(".defaultsContainer").hide();
a("#widgets-right .widgets-sortables").on("sort",function(b,c){a("#widgets-right");c.position.top=-a("#widgets-right").css("top")})})})(jQuery);function trim(k){k=k.replace(/^\s\s*/,"");for(var a=k.length-1;0<=a;a--)if(/\S/.test(k.charAt(a))){k=k.substring(0,a+1);break}return k};
