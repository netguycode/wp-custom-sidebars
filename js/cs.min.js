function CsSidebar(id,type){if(this.id=id.split("%").join("\\%"),this.type=type,this.sb=jQuery("#"+this.id),this.widgets="",this.name=trim(this.sb.find(".sidebar-name h3").text()),this.description=trim(this.sb.find(".sidebar-description").text()),"custom"==type)var editbar=csSidebars.extras.find(".cs-custom-sidebar").clone();else var editbar=csSidebars.extras.find(".cs-theme-sidebar").clone();this.sb.parent().append(editbar),editbar.find("label").each(function(){var me=jQuery(this);csSidebars.addIdToLabel(me,id)})}function trim(str){str=str.replace(/^\s\s*/,"");for(var i=str.length-1;i>=0;i--)if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break}return str}CsSidebar.prototype.getID=function(){return this.id.split("\\").join("")};var csSidebars,msgTimer;!function(){csSidebars={sidebars:[],sidebar_prefix:"cs-",edit_form:null,delete_form:null,export_form:null,location_form:null,right:null,extras:null,action_handlers:{},init:function(){"undefined"!=typeof csSidebarsData&&csSidebars.initControls().initScrollbar().initTopTools().initSidebars().initToolbars().initColumns()},initControls:function(){return csSidebars.right=jQuery("#widgets-right"),csSidebars.extras=jQuery("#cs-widgets-extra"),null==csSidebars.edit_form&&(csSidebars.edit_form=csSidebars.extras.find(".cs-editor").clone(),csSidebars.extras.find(".cs-editor").remove()),null==csSidebars.delete_form&&(csSidebars.delete_form=csSidebars.extras.find(".cs-delete").clone(),csSidebars.extras.find(".cs-delete").remove()),null==csSidebars.export_form&&(csSidebars.export_form=csSidebars.extras.find(".cs-export").clone(),csSidebars.extras.find(".cs-export").remove()),null==csSidebars.location_form&&(csSidebars.location_form=csSidebars.extras.find(".cs-location").clone(),csSidebars.extras.find(".cs-location").remove()),jQuery("#cs-title-options").detach().prependTo(csSidebars.right),csSidebars},initScrollbar:function(){var right_side=jQuery(".widget-liquid-right");wnd=jQuery(window),viewport=null,csSidebars.right.addClass("overview").wrap('<div class="viewport" />'),right_side.height(wnd.height()).prepend('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>').tinyscrollbar(),viewport=jQuery(".viewport").height(wnd.height()-32);var update_scrollbars=function(){right_side.data("plugin_tinyscrollbar").update("relative")};return wnd.resize(function(){right_side.height(wnd.height()),viewport.height(wnd.height()-32),update_scrollbars()}),right_side.click(function(){setTimeout(update_scrollbars,400)}),wnd.on("cs-resize",update_scrollbars),right_side.hover(function(){right_side.find(".scrollbar").fadeIn()},function(){right_side.find(".scrollbar").fadeOut()}),setTimeout(update_scrollbars,1e3),csSidebars},initColumns:function(){function toggle_sort(){var me=jQuery(this),col=me.closest(".sidebars-column-1, .sidebars-column-2"),dir=col.data("sort-dir");dir="asc"==dir?"desc":"asc",csSidebars.sort_sidebars(col,dir)}var col1=csSidebars.right.find(".sidebars-column-1"),col2=csSidebars.right.find(".sidebars-column-2"),title=jQuery('<div class="cs-title"><h3></h3></div>'),sidebars=csSidebars.right.find(".widgets-holder-wrap");col2.length||(col2=jQuery('<div class="sidebars-column-2"></div>'),col2.appendTo(csSidebars.right)),title.find("h3").append('<span class="cs-title-val"></span><i class="cs-icon dashicons dashicons-sort"></i>').css({cursor:"pointer"}),title.clone().prependTo(col1).click(toggle_sort).find(".cs-title-val").text(csSidebarsData.custom_sidebars),title.clone().prependTo(col2).click(toggle_sort).find(".cs-title-val").text(csSidebarsData.theme_sidebars),col1=jQuery('<div class="inner"></div>').appendTo(col1),col2=jQuery('<div class="inner"></div>').appendTo(col2),sidebars.each(function(){var me=jQuery(this),sbar=me.find(".widgets-sortables");csSidebars.isCustomSidebar(sbar)?me.appendTo(col1):me.appendTo(col2)})},initSidebars:function(){return csSidebars.right.find(".widgets-sortables").each(function(){var sb,state=!1,me=jQuery(this),id=me.attr("id");if(me.data("cs-init")!==!0)if(me.data("cs-init",!0),csSidebars.isCustomSidebar(this))sb=csSidebars.add(id,"custom");else{sb=csSidebars.add(id,"theme");for(key in csSidebarsData.replaceable)if(csSidebarsData.replaceable.hasOwnProperty(key)&&csSidebarsData.replaceable[key]==id){state=!0;break}csSidebars.setReplaceable(sb,state,!1)}}),csSidebars},initTopTools:function(){var btn_create=jQuery(".btn-create-sidebar"),btn_export=jQuery(".btn-export"),topbar=jQuery(".cs-options"),txt_filter=jQuery('<input type="search" class="cs-filter" />'),data={};return btn_create.click(function(){data.id="",data.title=csSidebarsData.title_new,data.button=csSidebarsData.btn_new,data.description="",data.name="",csSidebars.showEditor(data)}),btn_export.click(csSidebars.showExport),txt_filter.appendTo(topbar).attr("placeholder",csSidebarsData.filter).keyup(csSidebars.filter_sidebars).on("search",csSidebars.filter_sidebars),csSidebars},initToolbars:function(){var tool_action=function(ev){var me=jQuery(ev.target).closest(".cs-tool"),action=me.data("action"),id=csSidebars.getIdFromEditbar(me),sb=csSidebars.find(id);return!csSidebars.handleAction(action,sb)};return csSidebars.registerAction("edit",csSidebars.showEditor),csSidebars.registerAction("location",csSidebars.showLocations),csSidebars.registerAction("delete",csSidebars.showRemove),csSidebars.registerAction("replaceable",csSidebars.setReplaceable),csSidebars.right.on("click",".cs-tool",tool_action),csSidebars},handleAction:function(action,sb){return"function"==typeof csSidebars.action_handlers[action]?!!csSidebars.action_handlers[action](sb):!1},registerAction:function(action,callback){csSidebars.action_handlers[action]=callback},showAjaxError:function(details){var msg={};msg.message=csSidebarsData.ajax_error,msg.details=details,msg.parent="#widgets-right",msg.insert_after="#cs-title-options",msg.id="editor",msg.type="err",wpmUi.message(msg)},sort_sidebars:function(col,dir){var sidebars=col.find(".widgets-holder-wrap"),icon=col.find(".cs-title .cs-icon");sidebars.sortElements(function(a,b){var val_a=jQuery(a).find(".sidebar-name h3").text(),val_b=jQuery(b).find(".sidebar-name h3").text();return"asc"==dir?val_a>val_b?1:-1:val_b>val_a?1:-1}),col.data("sort-dir",dir),"asc"==dir?icon.removeClass("dashicons-arrow-down dashicons-sort").addClass("dashicons-arrow-up"):icon.removeClass("dashicons-arrow-up dashicons-sort").addClass("dashicons-arrow-down")},filter_sidebars:function(){var query=jQuery("input.cs-filter").val().toLowerCase(),all=csSidebars.right.find(".widgets-holder-wrap");all.each(function(){var sb=jQuery(this),title=sb.find(".sidebar-name h3").text();-1!=title.toLowerCase().indexOf(query)?sb.show():sb.hide()}),jQuery(window).trigger("cs-resize")},showEditor:function(data){var popup=null,ajax=null;data instanceof CsSidebar&&(data={id:data.getID(),title:csSidebarsData.title_edit.replace("[Sidebar]",data.name),button:csSidebarsData.btn_edit});var hide_extras=function(){popup.$().removeClass("csb-has-more"),popup.size(null,215)},show_extras=function(){popup.$().addClass("csb-has-more"),popup.size(null,545)},toggle_extras=function(){jQuery(this).prop("checked")?show_extras():hide_extras()},set_values=function(data,okay){return popup.loading(!1),data?okay?(void 0!==data.sidebar&&(data=data.sidebar),void 0!==data.id&&popup.$().find("#csb-id").val(data.id),void 0!==data.name&&popup.$().find("#csb-name").val(data.name),void 0!==data.description&&popup.$().find("#csb-description").val(data.description),void 0!==data.before_title&&popup.$().find("#csb-before-title").val(data.before_title),void 0!==data.after_title&&popup.$().find("#csb-after-title").val(data.after_title),void 0!==data.before_widget&&popup.$().find("#csb-before-widget").val(data.before_widget),void 0!==data.after_widget&&popup.$().find("#csb-after-widget").val(data.after_widget),void 0!==data.button&&popup.$().find(".btn-save").text(data.button),void 0):(popup.close(),csSidebars.showAjaxError(data),!1):!1},handle_done_save=function(resp,okay){var sb,msg={};popup.loading(!1).close(),msg.message=resp.message,msg.parent="#widgets-right",msg.insert_after="#cs-title-options",msg.id="editor",okay?"update"==resp.action?(sb=csSidebars.find(resp.data.id),csSidebars.updateSidebar(sb,resp.data)):"insert"==resp.action&&csSidebars.insertSidebar(resp.data):msg.type="err",wpmUi.message(msg)},save_data=function(){var form=popup.$().find("form");return popup.loading(!0),ajax.reset().data(form).ondone(handle_done_save).load_json(),!1};return popup=wpmUi.popup().modal(!0).title(data.title).onshow(hide_extras).content(csSidebars.edit_form),hide_extras(),set_values(data,!0,null),ajax=wpmUi.ajax(null,"cs-ajax"),data.id&&(popup.loading(!0),ajax.reset().data({"do":"get",sb:data.id}).ondone(set_values).load_json()),popup.show(),popup.$().find("#csb-name").focus(),popup.$().on("click","#csb-more",toggle_extras),popup.$().on("click",".btn-save",save_data),popup.$().on("click",".btn-cancel",popup.close),!0},updateSidebar:function(sb,data){return sb.sb.find(".sidebar-name h3").text(data.name),sb.sb.find(".sidebar-description").html('<p class="description"></p>').find(".description").text(data.description),csSidebars},insertSidebar:function(data){var box=jQuery('<div class="widgets-holder-wrap"></div>'),inner=jQuery('<div class="widgets-sortables ui-sortable"></div>'),name=jQuery('<div class="sidebar-name"><div class="sidebar-name-arrow"><br></div><h3></h3></div>'),desc=jQuery('<div class="sidebar-description"></div>'),col=csSidebars.right.find(".sidebars-column-1 > .inner:first");return inner.attr("id",data.id),name.find("h3").text(data.name),desc.html('<p class="description"></p>').find(".description").text(data.description),name.appendTo(inner),desc.appendTo(inner),inner.appendTo(box),box.prependTo(col),jQuery("#widgets-right .sidebar-name").unbind("click"),jQuery("#widgets-left .sidebar-name").unbind("click"),jQuery(document.body).unbind("click.widgets-toggle"),jQuery(".widgets-chooser").off("click.widgets-chooser").off("keyup.widgets-chooser"),jQuery("#available-widgets .widget .widget-title").off("click.widgets-chooser"),jQuery(".widgets-chooser-sidebars").empty(),wpWidgets.init(),csSidebars.initSidebars(),csSidebars},showExport:function(){var popup=null,ajax=null,do_export=function(ev){var form=jQuery(this).closest("form");return ajax.reset().data(form).load_http(),popup.close(),ev.preventDefault(),!1},handle_done_upload=function(resp,okay){var msg={};popup.loading(!1),okay?popup.size(900,600).content(resp.html):(msg.message=resp.message,msg.parent=popup.$().find(".wpmui-wnd-content"),msg.insert_after=!1,msg.id="export",msg["class"]="wpmui-wnd-err",msg.type="err",wpmUi.message(msg))},do_upload=function(ev){var ajax=wpmUi.ajax(),form=jQuery(this).closest("form");return popup.loading(!0),ajax.data(form).ondone(handle_done_upload).load_json("cs-ajax"),ev.preventDefault(),!1},toggle_widgets=function(){var me=jQuery(this),checked=me.prop("checked"),items=popup.$().find(".column-widgets, .import-widgets");checked?items.show():items.hide()},show_overview=function(){popup.size(740,480).content(csSidebars.export_form)},do_import=function(){var form=popup.$().find(".frm-import");popup.loading(!0),ajax.reset().data(form).load_http("_self")};return popup=wpmUi.popup().modal(!0).size(740,480).title(csSidebarsData.title_export).content(csSidebars.export_form).show(),ajax=wpmUi.ajax(null,"cs-ajax"),popup.$().on("submit",".frm-export",do_export),popup.$().on("submit",".frm-preview-import",do_upload),popup.$().on("change","#import-widgets",toggle_widgets),popup.$().on("click",".btn-cancel",show_overview),popup.$().on("click",".btn-import",do_import),!0},showRemove:function(sb){var popup=null,ajax=null,id=sb.getID(),name=sb.name,insert_name=function(el){el.find(".name").text(name)},close_popup=function(){popup.loading(!1).close()},handle_done=function(resp,okay){var msg={};popup.loading(!1).close(),msg.message=resp.message,msg.parent="#widgets-right",msg.insert_after="#cs-title-options",msg.id="editor",okay?(csSidebars.right.find("#"+id).closest(".widgets-holder-wrap").remove(),csSidebars.remove(id)):msg.type="err",wpmUi.message(msg)},delete_sidebar=function(){popup.loading(!0),ajax.reset().data({"do":"delete",sb:id}).ondone(handle_done).load_json()};return popup=wpmUi.popup().modal(!0).size(null,160).title(csSidebarsData.title_delete).content(csSidebars.delete_form).onshow(insert_name).show(),ajax=wpmUi.ajax(null,"cs-ajax"),popup.$().on("click",".btn-cancel",close_popup),popup.$().on("click",".btn-delete",delete_sidebar),!0},showLocations:function(sb){var popup=null,ajax=null,form=null,id=sb.getID(),handle_done_load=function(resp,okay){if(popup.loading(!1),!okay)return popup.close(),csSidebars.showAjaxError(resp),void 0;popup.$().find(".sb-name").text(resp.sidebar.name);var sb_id=resp.sidebar.id,sidebars=popup.$().find(".cs-replaceable");sidebars.hide(),resp.replaceable=wpmUi.obj(resp.replaceable);for(key in resp.replaceable)resp.replaceable.hasOwnProperty(key)&&sidebars.filter("."+resp.replaceable[key]).show();var _add_option=function(item,lists){var opt=jQuery("<option></option>");opt.attr("value",key).text(item.name),lists.append(opt)},_select_option=function(replacement,sidebar,key,lists){var row=lists.closest(".cs-replaceable").filter("."+sidebar),option=row.find('option[value="'+key+'"]'),group=row.find("optgroup.used"),check=row.find(".detail-toggle");replacement==sb_id?(option.prop("selected",!0),1!=check.prop("checked")&&(check.prop("checked",!0),row.addClass("open"),wpmUi.upgrade_multiselect(row))):(group.length||(group=jQuery('<optgroup class="used">').attr("label",row.data("lbl-used")).appendTo(row.find(".details select"))),option.detach().appendTo(group))},lst_cat=popup.$().find(".cs-datalist.cs-cat"),lst_act=popup.$().find(".cs-datalist.cs-arc-cat"),data=resp.categories;lst_act.empty(),lst_cat.empty();for(var key in data)_add_option(data[key],lst_act),_add_option(data[key],lst_cat);for(var key in data){if(data[key].single)for(var theme_sb in data[key].single)_select_option(data[key].single[theme_sb],theme_sb,key,lst_cat);if(data[key].archive)for(var theme_sb in data[key].archive)_select_option(data[key].archive[theme_sb],theme_sb,key,lst_act)}var lst_pst=popup.$().find(".cs-datalist.cs-pt"),data=resp.posttypes;lst_pst.empty();for(var key in data){var opt=jQuery("<option></option>"),name=data[key].name;opt.attr("value",key).text(name),lst_pst.append(opt)}for(var key in data)if(data[key].single)for(var theme_sb in data[key].single)_select_option(data[key].single[theme_sb],theme_sb,key,lst_pst);var lst_arc=popup.$().find(".cs-datalist.cs-arc"),data=resp.archives;lst_arc.empty();for(var key in data){var opt=jQuery("<option></option>"),name=data[key].name;opt.attr("value",key).text(name),lst_arc.append(opt)}for(var key in data)if(data[key].archive)for(var theme_sb in data[key].archive)_select_option(data[key].archive[theme_sb],theme_sb,key,lst_arc);var lst_aut=popup.$().find(".cs-datalist.cs-arc-aut"),data=resp.authors;lst_aut.empty();for(var key in data){var opt=jQuery("<option></option>"),name=data[key].name;opt.attr("value",key).text(name),lst_aut.append(opt)}for(var key in data)if(data[key].archive)for(var theme_sb in data[key].archive)_select_option(data[key].archive[theme_sb],theme_sb,key,lst_aut)},toggle_details=function(){var inp=jQuery(this),row=inp.closest(".cs-replaceable"),sel=row.find("select");inp.prop("checked")?(row.addClass("open"),wpmUi.upgrade_multiselect(row),sel.trigger("change.select2")):(row.removeClass("open"),sel.val([]))},handle_done_save=function(resp,okay){var msg={};popup.loading(!1).close(),msg.message=resp.message,msg.parent="#widgets-right",msg.insert_after="#cs-title-options",msg.id="editor",okay||(msg.type="err"),wpmUi.message(msg)},save_data=function(){popup.loading(!0),ajax.reset().data(form).ondone(handle_done_save).load_json()};return popup=wpmUi.popup().modal(!0).size(null,560).title(csSidebarsData.title_location).content(csSidebars.location_form).show(),popup.loading(!0),form=popup.$().find(".frm-location"),form.find(".sb-id").val(id),ajax=wpmUi.ajax(null,"cs-ajax"),ajax.reset().data({"do":"get-location",sb:id}).ondone(handle_done_load).load_json(),popup.$().on("click",".detail-toggle",toggle_details),popup.$().on("click",".btn-save",save_data),popup.$().on("click",".btn-cancel",popup.close),!0},setReplaceable:function(sb,state,do_ajax){var ajax,theme_sb=csSidebars.right.find(".sidebars-column-2 .widgets-holder-wrap"),the_bar=jQuery(sb.sb).closest(".widgets-holder-wrap"),chk=the_bar.find(".cs-toolbar .chk-replaceable"),marker=the_bar.find(".replace-marker"),handle_done_replaceable=(the_bar.find(".cs-toolbar .btn-replaceable"),function(resp){resp instanceof Object&&"object"==typeof resp.replaceable&&(csSidebarsData.replaceable=wpmUi.obj(resp.replaceable),theme_sb.find(".widgets-sortables").each(function(){var _state=!1,_me=jQuery(this),_id=_me.attr("id"),_sb=csSidebars.find(_id);for(key in csSidebarsData.replaceable)if(csSidebarsData.replaceable.hasOwnProperty(key)&&csSidebarsData.replaceable[key]==_id){_state=!0;break}csSidebars.setReplaceable(_sb,_state,!1)})),theme_sb.find(".cs-toolbar .chk-replaceable").prop("disabled",!1),theme_sb.find(".cs-toolbar .btn-replaceable").removeClass("wpmui-loading")});return void 0==state&&(state=chk.prop("checked")),void 0==do_ajax&&(do_ajax=!0),chk.data("active")==state?!1:(chk.data("active",state),chk.prop("checked",state),state?(marker.length||jQuery("<div></div>").appendTo(the_bar).attr("data-label",csSidebarsData.lbl_replaceable).addClass("replace-marker"),the_bar.addClass("replaceable")):(marker.remove(),the_bar.removeClass("replaceable")),do_ajax&&(theme_sb.find(".cs-toolbar .chk-replaceable").prop("disabled",!0),theme_sb.find(".cs-toolbar .btn-replaceable").addClass("wpmui-loading"),ajax=wpmUi.ajax(null,"cs-ajax"),ajax.reset().data({"do":"replaceable",state:state,sb:sb.getID()}).ondone(handle_done_replaceable).load_json()),!1)},find:function(id){return csSidebars.sidebars[id]},add:function(id,type){return csSidebars.sidebars[id]=new CsSidebar(id,type),csSidebars.sidebars[id]},remove:function(id){delete csSidebars.sidebars[id]},isCustomSidebar:function(el){var id=jQuery(el).attr("id"),prefix=id.substr(0,csSidebars.sidebar_prefix.length);return prefix==csSidebars.sidebar_prefix},addIdToLabel:function($obj,id){if(1!=$obj.data("label-done")){var prefix=$obj.attr("for");$obj.attr("for",prefix+id),$obj.find(".has-label").attr("id",prefix+id),$obj.data("label-done",!0)}},getIdFromEditbar:function($obj){var wrapper=$obj.closest(".widgets-holder-wrap"),sb=wrapper.find(".widgets-sortables:first"),id=sb.attr("id");return id}},jQuery(function($){$("#csfooter").hide(),$("#widgets-right").length>0&&csSidebars.init(),$(".defaultsContainer").hide(),$("#widgets-right .widgets-sortables").on("sort",function(event,ui){$("#widgets-right").top;ui.position.top=-$("#widgets-right").css("top")})})}(jQuery),jQuery.fn.sortElements=function(){var sort=[].sort;return function(comparator,getSortable){getSortable=getSortable||function(){return this};var placements=this.map(function(){var sortElement=getSortable.call(this),parentNode=sortElement.parentNode,nextSibling=parentNode.insertBefore(document.createTextNode(""),sortElement.nextSibling);return function(){if(parentNode===this)throw new Error("You can't sort elements if any one is a descendant of another.");parentNode.insertBefore(this,nextSibling),parentNode.removeChild(nextSibling)}});return sort.call(this,comparator).each(function(i){placements[i].call(getSortable.call(this))})}}();
//# sourceMappingURL=cs.min.js.map