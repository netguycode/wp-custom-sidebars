function CsSidebar(e,i){if(this.id=e.split("%").join("\\%"),this.type=i,this.sb=jQuery("#"+this.id),this.widgets="",this.name=trim(this.sb.find(".sidebar-name h3").text()),this.description=trim(this.sb.find(".sidebar-description").text()),"custom"==i)var s=csSidebars.extras.find(".cs-custom-sidebar").clone();else var s=csSidebars.extras.find(".cs-theme-sidebar").clone();this.sb.parent().append(s),s.find("label").each(function(){var i=jQuery(this);csSidebars.addIdToLabel(i,e)})}function trim(e){e=e.replace(/^\s\s*/,"");for(var i=e.length-1;i>=0;i--)if(/\S/.test(e.charAt(i))){e=e.substring(0,i+1);break}return e}CsSidebar.prototype.getID=function(){return this.id.split("\\").join("")};var csSidebars,msgTimer;!function(e){csSidebars={sidebars:[],sidebar_prefix:"cs-",edit_form:null,delete_form:null,export_form:null,location_form:null,right:null,extras:null,init:function(){csSidebars.initControls().initScrollbar().initTopTools().initSidebars().initToolbars().initColumns()},initControls:function(){return csSidebars.right=jQuery("#widgets-right"),csSidebars.extras=jQuery("#cs-widgets-extra"),null==csSidebars.edit_form&&(csSidebars.edit_form=csSidebars.extras.find(".cs-editor").clone(),csSidebars.extras.find(".cs-editor").remove()),null==csSidebars.delete_form&&(csSidebars.delete_form=csSidebars.extras.find(".cs-delete").clone(),csSidebars.extras.find(".cs-delete").remove()),null==csSidebars.export_form&&(csSidebars.export_form=csSidebars.extras.find(".cs-export").clone(),csSidebars.extras.find(".cs-export").remove()),null==csSidebars.location_form&&(csSidebars.location_form=csSidebars.extras.find(".cs-location").clone(),csSidebars.extras.find(".cs-location").remove()),jQuery("#cs-title-options").detach().prependTo(csSidebars.right),csSidebars},initScrollbar:function(){var i=jQuery(".widget-liquid-right");wnd=jQuery(window),viewport=null,scrollbar=null,csSidebars.right.addClass("overview").wrap('<div class="viewport" />'),viewport=jQuery(".viewport").height(wnd.height()-60),i.height(wnd.height()).prepend('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>').tinyscrollbar(),scrollbar=i.data("plugin_tinyscrollbar");var s=function(){scrollbar.update("relative")};return wnd.resize(function(){i.height(wnd.height()),viewport.height(wnd.height()-60),scrollbar.update("relative")}),i.click(function(){setTimeout(s,400)}),i.hover(function(){e(".scrollbar").fadeIn()},function(){e(".scrollbar").fadeOut()}),csSidebars},initColumns:function(){var e=csSidebars.right.find(".sidebars-column-1"),i=csSidebars.right.find(".sidebars-column-2"),s=jQuery('<div class="cs-title"><h3></h3></div>'),t=jQuery('<div class="cs-title"><h3></h3></div>'),a=csSidebars.right.find(".widgets-holder-wrap");i.length||(i=jQuery('<div class="sidebars-column-2"></div>'),i.appendTo(csSidebars.right)),s.find("h3").text(csSidebarsData.custom_sidebars),t.find("h3").text(csSidebarsData.theme_sidebars),e.prepend(s),i.prepend(t),a.each(function(){var s=jQuery(this),t=s.find(".widgets-sortables");csSidebars.isCustomSidebar(t)?s.appendTo(e):s.appendTo(i)})},initTopTools:function(){var e=jQuery(".btn-create-sidebar"),i=jQuery(".btn-export"),s={};return e.click(function(){s.id="",s.title=csSidebarsData.title_new,s.button=csSidebarsData.btn_new,s.description="",s.name="",csSidebars.showEditor(s)}),i.click(csSidebars.showExport),csSidebars},initSidebars:function(){return csSidebars.right.find(".widgets-sortables").each(function(){var e,i,s,t=jQuery(this),a=t.attr("id");if(t.data("cs-init")!==!0)if(t.data("cs-init",!0),csSidebars.isCustomSidebar(this))e=csSidebars.add(a,"custom");else{for(e=csSidebars.add(a,"theme"),i=!1,s=0;s<csSidebarsData.replaceable.length;s+=1)if(csSidebarsData.replaceable[s]==a){i=!0;break}csSidebars.setReplaceable(e,i,!1)}}),csSidebars},initToolbars:function(){var e=function(e){var i=jQuery(e.target).closest(".cs-tool"),s=csSidebars.getIdFromEditbar(i),t=csSidebars.find(s);if(i.hasClass("delete-sidebar"))return csSidebars.showRemove(t),!1;if(i.hasClass("edit-sidebar")){var a={id:t.getID(),title:csSidebarsData.title_edit+" "+t.name,button:csSidebarsData.btn_edit};return csSidebars.showEditor(a),!1}return i.hasClass("where-sidebar")?(csSidebars.showLocations(t),!1):i.hasClass("btn-replaceable")?(csSidebars.setReplaceable(t),!0):void 0};return csSidebars.right.on("click",".cs-tool",e),csSidebars},showEditor:function(e){var i=null,s=null,t=function(){i.$().removeClass("csb-has-more"),i.size(null,205)},a=function(){i.$().addClass("csb-has-more"),i.size(null,540)},r=function(){jQuery(this).prop("checked")?a():t()},n=function(e,s){return i.loading(!1),s&&e?(void 0!==e.sidebar&&(e=e.sidebar),void 0!==e.id&&i.$().find("#csb-id").val(e.id),void 0!==e.name&&i.$().find("#csb-name").val(e.name),void 0!==e.description&&i.$().find("#csb-description").val(e.description),void 0!==e.before_title&&i.$().find("#csb-before-title").val(e.before_title),void 0!==e.after_title&&i.$().find("#csb-after-title").val(e.after_title),void 0!==e.before_widget&&i.$().find("#csb-before-widget").val(e.before_widget),void 0!==e.after_widget&&i.$().find("#csb-after-widget").val(e.after_widget),void 0!==e.button&&i.$().find(".btn-save").text(e.button),void 0):!1},d=function(e,s){var t,a={};i.loading(!1).close(),a.message=e.message,a.parent="#widgets-right",a.insert_after="#cs-title-options",a.id="editor",s?"update"==e.action?(t=csSidebars.find(e.data.id),csSidebars.updateSidebar(t,e.data)):"insert"==e.action&&csSidebars.insertSidebar(e.data):a.type="err",wpmUi.message(a)},o=function(){var e=i.$().find("form");return i.loading(!0),s.reset().data(e).ondone(d).load_json(),!1};return i=wpmUi.popup().modal(!0).title(e.title).onshow(t).content(csSidebars.edit_form),t(),n(e,!0,null),s=wpmUi.ajax(null,"cs-ajax"),e.id&&(i.loading(!0),s.reset().data({"do":"get",sb:e.id}).ondone(n).load_json()),i.show(),i.$().on("click","#csb-more",r),i.$().on("click",".btn-save",o),i.$().on("click",".btn-cancel",i.close),csSidebars},updateSidebar:function(e,i){return e.sb.find(".sidebar-name h3").text(i.name),e.sb.find(".sidebar-description").html('<p class="description">'+i.description+"</p>"),csSidebars},insertSidebar:function(e){var i=jQuery('<div class="widgets-holder-wrap"></div>'),s=jQuery('<div class="widgets-sortables ui-sortable"></div>'),t=jQuery('<div class="sidebar-name"><div class="sidebar-name-arrow"><br></div><h3></h3></div>'),a=jQuery('<div class="sidebar-description"></div>'),r=csSidebars.right.find(".sidebars-column-1");return s.attr("id",e.id),t.find("h3").text(e.name),a.html('<p class="description">'+e.description+"</p>"),t.appendTo(s),a.appendTo(s),s.appendTo(i),i.appendTo(r),jQuery("#widgets-right .sidebar-name").unbind("click"),jQuery("#widgets-left .sidebar-name").unbind("click"),jQuery(document.body).unbind("click.widgets-toggle"),jQuery(".widgets-chooser").off("click.widgets-chooser").off("keyup.widgets-chooser"),wpWidgets.init(),csSidebars.initSidebars(),csSidebars},showExport:function(){var e=null,i=null,s=function(e){var i=wpmUi.ajax(),s=jQuery(this).closest("form");return i.data(s).load_http("cs-ajax"),e.preventDefault(),!1},t=function(i,s){var t={};e.loading(!1),s?e.size(900,600).content(i.html):(t.message=i.message,t.parent=e.$().find(".wpmui-wnd-content"),t.insert_after=!1,t.id="export",t.class="wpmui-wnd-err",t.type="err",wpmUi.message(t))},a=function(i){var s=wpmUi.ajax(),a=jQuery(this).closest("form");return e.loading(!0),s.data(a).ondone(t).load_json("cs-ajax"),i.preventDefault(),!1},r=function(){var i=jQuery(this),s=i.prop("checked"),t=e.$().find(".column-widgets, .import-widgets");s?t.show():t.hide()},n=function(){e.size(740,480).content(csSidebars.export_form)},d=function(i,s){var t={};e.loading(!1).close(),t.message=i.message,t.parent="#widgets-right",t.insert_after="#cs-title-options",t.id="import",s||(t.type="err"),wpmUi.message(t)},o=function(){var s=e.$().find(".frm-import");e.loading(!0),i.reset().data(s).ondone(d).load_json()};return e=wpmUi.popup().modal(!0).size(740,480).title(csSidebarsData.title_export).content(csSidebars.export_form).show(),i=wpmUi.ajax(null,"cs-ajax"),e.$().on("submit",".frm-export",s),e.$().on("submit",".frm-preview-import",a),e.$().on("change","#import-widgets",r),e.$().on("click",".btn-cancel",n),e.$().on("click",".btn-import",o),!1},showRemove:function(e){var i=null,s=null,t=e.getID(),a=e.name,r=function(e){e.find(".name").text(a)},n=function(){i.loading(!1).close()},d=function(e,s){var a={};i.loading(!1).close(),a.message=e.message,a.parent="#widgets-right",a.insert_after="#cs-title-options",a.id="editor",s?(csSidebars.right.find("#"+t).closest(".widgets-holder-wrap").remove(),csSidebars.remove(t)):a.type="err",wpmUi.message(a)},o=function(){i.loading(!0),s.reset().data({"do":"delete",sb:t}).ondone(d).load_json()};return i=wpmUi.popup().modal(!0).size(null,160).title(csSidebarsData.title_delete).content(csSidebars.delete_form).onshow(r).show(),s=wpmUi.ajax(null,"cs-ajax"),i.$().on("click",".btn-cancel",n),i.$().on("click",".btn-delete",o),!1},showLocations:function(e){var i=null,s=null,t=null,a=e.getID(),r=function(e,s){if(i.loading(!1),!s)return!1;i.$().find(".sidebar-name").text(e.sidebar.name);var t=e.sidebar.id,a=i.$().find(".cs-replaceable");a.hide();for(var r=e.replaceable.length-1;r>=0;r-=1)a.filter("."+e.replaceable[r]).show();var n=function(e,i){var s=jQuery("<option></option>");s.attr("value",b).text(e.name),i.append(s)},d=function(e,i,s,a){var r=a.closest(".cs-replaceable").filter("."+i),n=r.find('option[value="'+s+'"]'),d=r.find("optgroup.used");e==t?(n.prop("selected",!0),r.find(".detail-toggle").prop("checked",!0),r.addClass("open")):(d.length||(d=jQuery('<optgroup class="used">').attr("label",r.data("lbl-used")).appendTo(r.find(".details select"))),n.detach().appendTo(d))},o=i.$().find(".cs-datalist.cs-cat"),c=i.$().find(".cs-datalist.cs-arc-cat"),l=e.categories;c.empty(),o.empty();for(var b in l)n(l[b],c),n(l[b],o);for(var b in l){if(l[b].single)for(var u in l[b].single)d(l[b].single[u],u,b,o);if(l[b].archive)for(var u in l[b].archive)d(l[b].archive[u],u,b,c)}var p=i.$().find(".cs-datalist.cs-pt"),l=e.posttypes;p.empty();for(var b in l){var f=jQuery("<option></option>"),m=l[b].name;f.attr("value",b).text(m),p.append(f)}for(var b in l)if(l[b].single)for(var u in l[b].single)d(l[b].single[u],u,b,p);var h=i.$().find(".cs-datalist.cs-arc"),l=e.archives;h.empty();for(var b in l){var f=jQuery("<option></option>"),m=l[b].name;f.attr("value",b).text(m),h.append(f)}for(var b in l)if(l[b].archive)for(var u in l[b].archive)d(l[b].archive[u],u,b,h);wpmUi.upgrade_multiselect(i.$())},n=function(){var e=jQuery(this),i=e.closest(".cs-replaceable");e.prop("checked")?i.addClass("open"):(i.removeClass("open"),i.find("select").val([]).trigger("chosen:updated"))},d=function(e,s){var t={};i.loading(!1).close(),t.message=e.message,t.parent="#widgets-right",t.insert_after="#cs-title-options",t.id="editor",s||(t.type="err"),wpmUi.message(t)},o=function(){i.loading(!0),s.reset().data(t).ondone(d).load_json()};return i=wpmUi.popup().modal(!0).size(null,500).title(csSidebarsData.title_location).content(csSidebars.location_form).show(),i.loading(!0),t=i.$().find(".frm-location"),t.find(".sb-id").val(a),s=wpmUi.ajax(null,"cs-ajax"),s.reset().data({"do":"get-location",sb:a}).ondone(r).load_json(),i.$().on("click",".detail-toggle",n),i.$().on("click",".btn-save",o),i.$().on("click",".btn-cancel",i.close),!1},setReplaceable:function(e,i,s){var t,a=jQuery(e.sb).closest(".widgets-holder-wrap"),r=a.find(".cs-toolbar .chk-replaceable"),n=a.find(".replace-marker");return void 0==i&&(i=r.prop("checked")),void 0==s&&(s=!0),r.data("active")==i?!1:(r.data("active",i),r.prop("checked",i),i?(n.length||jQuery("<div></div>").appendTo(a).addClass("replace-marker").attr("data-label",r.attr("data-label")),a.addClass("replaceable")):(n.remove(),a.removeClass("replaceable")),s&&(t=wpmUi.ajax(null,"cs-ajax"),t.reset().data({"do":"replaceable",state:i,sb:e.getID()}).load_json()),void 0)},showMessage:function(e,i){var s,t,a=jQuery("#cs-message"),r=function(){var e=jQuery("#cs-message");e.fadeOut(400),setTimeout(function(){e.remove()},400)};t=i?"cs-error":"cs-update",0!=a.length?(clearTimeout(msgTimer),a.removeClass("cs-error cs-update").addClass(t),a.text(e)):(a=jQuery('<div id="cs-message" class="cs-message"></div>'),s=jQuery('<a href="#" class="close">&times;</a>'),a.html(e).addClass(t).hide(),s.appendTo(a).click(r),a.insertAfter("#cs-title-options").fadeIn(),s.focus()),msgTimer=setTimeout(r,7e3)},find:function(e){return csSidebars.sidebars[e]},add:function(e,i){return csSidebars.sidebars[e]=new CsSidebar(e,i),csSidebars.sidebars[e]},remove:function(e){delete csSidebars.sidebars[e]},isCustomSidebar:function(e){var i=jQuery(e).attr("id"),s=i.substr(0,csSidebars.sidebar_prefix.length);return s==csSidebars.sidebar_prefix},addIdToLabel:function(e,i){if(1!=e.data("label-done")){var s=e.attr("for");e.attr("for",s+i),e.find(".has-label").attr("id",s+i),e.data("label-done",!0)}},getIdFromEditbar:function(e){var i=e.closest(".widgets-holder-wrap"),s=i.find(".widgets-sortables:first"),t=s.attr("id");return t}},jQuery(function(e){e("#csfooter").hide(),e("#widgets-right").length>0&&csSidebars.init(),e(".defaultsContainer").hide(),e("#widgets-right .widgets-sortables").on("sort",function(i,s){e("#widgets-right").top;s.position.top=-e("#widgets-right").css("top")})})}(jQuery);