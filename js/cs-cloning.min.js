jQuery(function(){var $doc=jQuery(document),$all=jQuery("#widgets-right"),is_cloning=!1,init_widget=function(ev,el){var $widget=jQuery(el).closest(".widget"),$btn=$widget.find(".csb-clone-button"),$target=$widget.find(".widget-control-actions .widget-control-save"),$spinner=$widget.find(".widget-control-actions .spinner"),$btn_save=$widget.find(".widget-control-save");1!=$widget.data("_csb_cloning")&&($spinner.insertBefore($target).css({"float":"left"}),$btn.insertBefore($target).click(clone_widget),$btn_save.click(prepare_update_group),$widget.data("_csb_cloning",!0))},update_group_counter=function(ev,el){if(is_cloning)return!1;for(var $widget=jQuery(el).closest(".widget"),$widget_group=$widget.find("input.csb-clone-group"),group_id=parseInt($widget_group.val()),check=null;;){if(check=$all.find('input.csb-clone-group[value="'+group_id+'"]'),!check.length||1==check.length&&check[0]==$widget_group[0])break;group_id+=1}$widget_group.val(group_id),update_template_groups()},update_template_groups=function(){for(var $groups=jQuery("#widgets-left input.csb-clone-group"),next_id=parseInt($groups.first().val());$all.find('input.csb-clone-group[value="'+next_id+'"]').length;)next_id+=1;$groups.val(next_id)},mark_group=function(){var $widget=jQuery(this).closest(".widget"),group_id=$widget.find("input.csb-clone-group").val(),$members=$all.find('input.csb-clone-group[value="'+group_id+'"]').closest(".widget");isNaN(group_id)||1>group_id||($members.addClass("csb-marker"),$widget.removeClass("csb-marker"))},unmark_group=function(){var $marked=jQuery(".widget.csb-marker");$marked.removeClass("csb-marker")},init_group_icons=function(){var $groups=$all.find("input.csb-clone-group");$groups.each(function(){var group_id=jQuery(this).val(),$members=$all.find('input.csb-clone-group[value="'+group_id+'"]').closest(".widget"),$titles=$members.find(".widget-title h4"),action="add";(isNaN(group_id)||1>group_id)&&(action="remove"),$members.length<2&&(action="remove"),$titles.removeClass("csb-group group-active").find(".btn-clone-group").remove(),$members.removeAttr("data-csb-icon"),"add"==action&&($titles.addClass("csb-group group-active").prepend('<i class="dashicons dashicons-admin-links btn-clone-group"></i> '),$titles.find(".btn-clone-group").hover(mark_group,unmark_group).click(toggle_group))})},toggle_group=function(ev){var $widget=jQuery(this).closest(".widget"),$title=$widget.find(".widget-title h4"),$icon=$title.find(".btn-clone-group"),$group=$widget.find("input.csb-clone-group");return ev.preventDefault(),ev.stopPropagation(),$title.hasClass("group-active")?($title.removeClass("group-active"),$icon.removeClass("dashicons-admin-links").addClass("dashicons-editor-unlink"),$group.data("group",$group.val()),$group.val(0),unmark_group()):($title.addClass("group-active"),$icon.addClass("dashicons-admin-links").removeClass("dashicons-editor-unlink"),$group.val($group.data("group")),mark_group.call(this,[ev])),!1},clone_widget=function(ev){var $widget=jQuery(this).closest(".widget"),$available=jQuery("#widgets-left"),$chooser=jQuery(".widgets-chooser"),$content=jQuery("#wpbody-content");ev.preventDefault(),is_cloning=!0;var state=$widget.find("input.csb-clone-state").val();"new"===state&&wpWidgets.save($widget,0,0,0),wpWidgets.clearWidgetSelection(),$chooser.slideUp(200,function(){$chooser.hide(),$content.append(this)});var class_name=$widget.find("input.id_base").val(),$base=$available.find('input.id_base[value="'+class_name+'"]'),$in_question=$base.closest(".widget");$in_question.addClass("widget-in-question");var group_id=$widget.find("input.csb-clone-group").val(),$group=($in_question.find(".widget-control-actions"),$in_question.find("input.csb-clone-group")),$state=$in_question.find("input.csb-clone-state");$group.val(group_id),$state.val("empty");var $sidebar=$widget.closest(".widgets-sortables"),sb_id=$sidebar.attr("id");return $chooser.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected"),$chooser.find("li").each(function(){var $li=jQuery(this);sb_id==$li.data("sidebarId")&&$li.addClass("widgets-chooser-selected").focus()}),wpWidgets.addWidget($chooser),wpWidgets.clearWidgetSelection(),update_template_groups(),is_cloning=!1,!1},populate_widget=function($widget){var $state=$widget.find("input.csb-clone-state");"empty"==$state.val()&&($widget.addClass("wpmui-loading"),wpWidgets.save($widget,0,1,0))},prepare_update_group=function(){var $widget=jQuery(this).closest(".widget"),group_id=$widget.find("input.csb-clone-group").val(),$members=$all.find('input.csb-clone-group[value="'+group_id+'"]').closest(".widget").not($widget);$members.each(function(){{var $item=jQuery(this);$item.find("input.csb-clone-state")}$item.addClass("wpmui-loading").attr("data-reload",!0)})},update_group_widgets=function(){var $widgets=$all.find(".widget[data-reload]");$widgets.each(function(){var $item=jQuery(this),$state=$item.find("input.csb-clone-state");$state.val("empty"),$item.removeAttr("data-reload"),wpWidgets.save($item,0,0,0)})},ajax_observer=function(ev,xhr,opt,resp){var data="string"==typeof opt.data?opt.data:"",find_action=data.match(/^.*&action=([^&]+).*$/);if(find_widget=data.match(/^.*&widget-id=([^&]+).*$/),action=find_action&&2==find_action.length?find_action[1]:"",widget=find_widget&&2==find_widget.length?find_widget[1]:"",widget.length){var $base=jQuery('.widget input.widget-id[value="'+widget+'"]'),$widget=$base.closest(".widget");switch(action){case"save-widget":$widget.removeClass("wpmui-loading"),resp.length?resp.match(/^deleted:/)?setTimeout(init_group_icons,400):(init_group_icons(),update_group_widgets($widget)):populate_widget($widget)}}};$all.find(".widget").each(init_widget),$doc.on("widget-added",init_widget),$doc.on("widget-added",update_group_counter),$doc.ajaxSuccess(ajax_observer),init_group_icons(),update_template_groups()});
//# sourceMappingURL=cs-cloning.min.js.map